<!DOCTYPE html>
<html style="height: 100%;">
<head>
<script type="text/javascript" language="JavaScript">
setTimeout(function(){
    // TODO
    var successPrompt = document.getElementById("successPrompt");
    if (successPrompt.style.visibility != 'visible') {
        var prompt = document.getElementById("timeoutPrompt");
        prompt.style.visibility = "visible";
        var modal = document.getElementById("clModal");
        modal.style.display = "block";
        let regexElement = document.querySelector('#abcd');
        regexElement.logProblemFinished(false);
    }
}, 420000);
// }, 10000);
// 7 minutes
</script>
<style type="text/css">
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content/Box */
.modal-content {
  background-color: #fefefe;
  margin: 15% auto; /* 15% from the top and centered */
  padding: 20px;
  border: 1px solid #888;
  width: 80%; /* Could be more or less, depending on screen size */
}

/* The Close Button */
.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}
</style>
</head>

<body style="background-color: gray; height: 100%; margin: 0;">
<div style="max-width:700px; margin: 0 auto;background-color:white; padding: 10px 30px;">
<h2>Problem 4 of 4</h2>
<div>
Capture email address with letters, numbers, underscore and dots. A valid email address defined in this problem must meet the following requirements:
<br>
<ul>
    <li>Has an "@" symbol in between;</li>
    <li>Before the "@" symbol, there can be one or more strings made of letters, numbers and underscores. A dot is used in between the strings. No two dots are allowed to appear consecutively.</li>
    <li>After the "@" symbol, there can two or more strings made of letters, numbers and underscores. A dot is used in between the strings. No two dots are allowed to appear consecutively.</li>
    <li>No other characters besides letters, numbers, underscores, dots, and the "@" symbol should appear in the email address.</li>
</ul>
<br>
For example, your regular expression should match email addresses like: abc@umich.edu, 8ab.c_def9@example.regex.com;
<br>
But your regex should not match: abc@ def., ab..abc@def.com, abc@def

</div>
<div class="test-div"></div>
<!-- TODO -->
<div id="clModal" class="modal">
  <!-- Modal content -->
  <div class="modal-content">
    <div id="successPrompt" style="visibility:collapse">Congratulations! You have passed all test cases for this problem.</div>
    <div id="timeoutPrompt" style="visibility:collapse">Your time has run out on this problem.</div>
    Please answer the following question.
    <p>In solving the preceding problem I invested:</p>
    <form>
        <input type="radio" id="cl-1" name="cognitive-load" value="1">
        <label for="cl-1">Very, very low mental effort</label><br>
        <input type="radio" id="cl-2" name="cognitive-load" value="2">
        <label for="cl-2">Very low mental effort</label><br>
        <input type="radio" id="cl-3" name="cognitive-load" value="3">
        <label for="cl-3">Low mental effort</label><br>
        <input type="radio" id="cl-4" name="cognitive-load" value="4">
        <label for="cl-4">Rather low mental effort</label><br>
        <input type="radio" id="cl-5" name="cognitive-load" value="5">
        <label for="cl-5">Neither low nor high mental effort</label><br>
        <input type="radio" id="cl-6" name="cognitive-load" value="6">
        <label for="cl-6">Rather high mental effort</label><br>
        <input type="radio" id="cl-7" name="cognitive-load" value="7">
        <label for="cl-7">High mental effort</label><br>
        <input type="radio" id="cl-8" name="cognitive-load" value="8">
        <label for="cl-8">Very high mental effort</label><br>
        <input type="radio" id="cl-9" name="cognitive-load" value="9">
        <label for="cl-9">Very, very high mental effort</label><br>
    </form>
    <br>
    <p>Thank you for completing the four problems! Please click on the button below to proceed to a short survey.</p>
    <button onclick="proceedToNextQuestion()">Proceed to the survey</button>
  </div>
</div>
<script type="module">
import "./regex-element.js";
document.querySelector('.test-div').innerHTML = `<regex-element input-type='parsons' id="abcd" problem-id='within4'></regex-element>`;
let regexElement = document.querySelector('#abcd');
regexElement.regexInput.expandableBlocks = ['(?:)'];
regexElement.regexInput.expandableBlockTooltips = ['Groups the expression inside the parentheses, but returns the full matched string as \'?:\' negates the effect of grouping'];
regexElement.parsonsExplanation = ['Matches alphanumeric characters and underscore (A-Z, a-z, 0-9, _)', 'Matches character \'@\' literally', 'Matches character \'.\' literally', 'Match 1 or more repetitions of the preceding expression','Match 0 or more repetitions of the preceding expression', 'Match either 0 or 1 repetitions of the preceding expression'];
regexElement.parsonsData = ['\\w', '@', '\\.', '+', '*', '?', '\\w+\\.', '\\w*\\.'];
regexElement.setTestCases([
    {input: 'abc@umich.edu', expect: ['abc@umich.edu'], notes:'A matching testcase'},
    {input: '8ab.c_def9@example.regex.com', expect:['8ab.c_def9@example.regex.com'], notes: 'A matching testcase'},
    {input: 'abc@asd@efsg', expect: [], notes:''},
    {input: 'abc@ def.', expect: [], notes: ''},
    {input: 'ab..abc@def.com', expect: [], notes: ''},
    {input: 'abc@def', expect: [], notes: ''},
    {input: 'abc.@def.com', expect: [], notes: ''},
    ]);
regexElement.setInitialTestString('match:\nabc@umich.edu\n8ab.c_def9@example.regex.com\n\ndo not match:\nabc@ def.\nab..abc@def.com\nabc@def\n');
regexElement.addEventListener('passed-all-testcases', function (e) {
    setTimeout(function(){
      // TODO
        var prompt = document.getElementById("successPrompt");
        prompt.style.visibility = "visible";
        var modal = document.getElementById("clModal");
        modal.style.display = "block";
        regexElement.logProblemFinished(true);
    }, 500);
})
</script>
<script>
function proceedToNextQuestion() {
    var radios = document.getElementsByName('cognitive-load');
    let checked = false;
    for (var i = 0, length = radios.length; i < length; i++) {
        if (radios[i].checked) {
            // do whatever you want with the checked radio
            let regexElement = document.querySelector('#abcd');
            regexElement.logCognitiveLoad(radios[i].value);
            checked = true;
            break;
        }
    }
    if (checked) {
        let href = 'https://umich.qualtrics.com/jfe/form/SV_7QG3xqZrducG622';
        setTimeout(function(){
          window.location.href = href;
        }, 500);
        return false;
    } else {
        alert('please select your answer');
        return false;
    }
}
</script>
</div>
</body>

</html>
