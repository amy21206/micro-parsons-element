<!DOCTYPE html>
<html>
<head>
<script src="skulpt.min.js" type="text/javascript"></script>
<script src="skulpt-stdlib.js" type="text/javascript"></script>
<link rel="stylesheet" href="xcode.css">
<link rel="stylesheet" href="demo.css">
<link rel="stylesheet" href="./micro-parsons/micro-parsons.css">
</head>

<body>

<script type="module">
import "./micro-parsons/micro-parsons.js";
</script>

<h3>Sample Problem</h3>
<div>
	Write a function sum13(nums) to return the sum of the numbers in the list nums, returning 0 for an empty list. Except the number 13 is very unlucky, so it does not count and a number that comes immediately after a 13 also does not count.  For example, sum13([13,2]) returns 0, sum13([1, 13, 4, 2])  returns 3, sum13([1, 2, 3])  returns 6.
</div>
<br>

Less Help <input type="range" min="0" max="2" id="scaffolding-slider" value="0"> More Help

<button style="
    margin-left: 40px;
    margin-bottom: 15px;
" id="run-btn">Run</button>

<textarea class="subgoal" id="write-code" style="width: 870px; height: 350px; overflow: scroll; white-space: pre; font-family: monospace;font-size: 15px;padding: 10px;" spellcheck="false"></textarea>

<micro-parsons language="python" id="micro-parsons-pseudo">
<mp-context subgoal>
# Subgoal 1: Define function and initialize variables.
def sum13(sums):
    total = 0
    found_13 = False
    <mp-context subgoal>
    # Subgoal 2: Start a loop to examine each number in the list.
    for num in nums:
    </mp-context>
        <mp-context subgoal>
        # Subgoal 3: Within the loop, handle the case for the number following 13.
        if found_13:
            found_13 = False
        </mp-context>
        <mp-context subgoal>
        # Subgoal 4: Handle the case for encountering a 13 in the list.
        <mp-line randomize indentation="1">
        <mp-block>==<mp-block-ttp>equals</mp-block-ttp></mp-block>
        <mp-block>else</mp-block>
        <mp-block>num</mp-block>
        <mp-block>:</mp-block>
        <mp-block>13</mp-block>
        <mp-block>elif</mp-block>
        <mp-block distractor>!=</mp-block>
        </mp-line>
            found_13 = True
        </mp-context>
        <mp-context subgoal>
        # Subgoal 5: Finally, handle the case for encountering a number that isn't 13 or doesn't follow a 13.
        else:
            total += num
        </mp-context>
    <mp-context subgoal>
    # Subgoal 6: Return the accumulated total after the loop ends.
    return total
    </mp-context>
</mp-context>
</micro-parsons>

<div class="output-div">
    Output: 
    <br>
    <pre id="output" class="output-pre"></pre>
</div>

</body>

</html>

<script>
var context = document.querySelector('mp-line').parentElement;
while (context.tagName == 'MP-CONTEXT') {
	if (context.firstChild.classList) {
		if (context.firstChild.classList.contains('subgoal')) {
			context.firstChild.click();	
		}

	}
	context = context.parentElement;
}

var slider = document.querySelector('#scaffolding-slider');
slider.oninput = function() {
	var value = this.value;
	if (value == '0') {
		document.querySelector('micro-parsons').style.display='none';
		document.querySelector('#write-code').style.display='block';
		document.querySelector('#write-code').value = `# Please write your code below`;
	} else if (value == '1') {
		document.querySelector('micro-parsons').style.display='none';
		document.querySelector('#write-code').style.display='block';
		document.querySelector('#write-code').value = 
`# Subgoal 1: Define function and initialize variables.
def sum13(sums):
    total = 0
    found_13 = False
    # Subgoal 2: Start a loop to examine each number in the list.

        # Subgoal 3: Within the loop, handle the case for the number following 13.

        # Subgoal 4: Handle the case for encountering a 13 in the list.

        # Subgoal 5: Finally, handle the case for encountering a number that isn't 13 or doesn't follow a 13.

    # Subgoal 6: Return the accumulated total after the loop ends.

		`;
	} else if (value == '2') {
		document.querySelector('micro-parsons').style.display='block';
		document.querySelector('#write-code').style.display='none';
        // see if user wrote code for each subgoal
        const subgoalReg = /# Subgoal .*\n/
        const split = document.querySelector('#write-code').value.split(subgoalReg);
        // from value 1
        let subgoalWritten = [];
        if (split.length > 6) {
            for (let i = 1; i < split.length; ++i) {
                if (split[i].trim() != '') {
                    subgoalWritten.push(true);
                } else {
                    subgoalWritten.push(false);
                }
            }
        }
        // expand/collapse each subgoal
        for (let i = 0; i < subgoalWritten.length; ++i) {
            document.querySelector('micro-parsons').toggleSubgoalExpand(i, subgoalWritten[i]);
        }
	}
}
slider.oninput();

</script>

<script>
// this part of the script handles skulpt

// output function: appends the output text to the "output" pre
function outf(text) {
    let mypre = document.getElementById("output");
    mypre.innerHTML = mypre.innerHTML + text;
}
// took from Skulpt doc. I think it reads skulpt module.
function builtinRead(x) {
    if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
            throw "File not found: '" + x + "'";
    return Sk.builtinFiles["files"][x];
}

// also from Skulpt doc.
// Here's everything you need to run a python program in skulpt
// grab the code from your textarea
// get a reference to your pre element for output
// configure the output function
// call Sk.importMainWithBody()
function runit() { 
   var prog = document.getElementById("write-code").value; 
   var mypre = document.getElementById("output"); 
   mypre.innerHTML = ''; 
   Sk.pre = "output";
   Sk.configure({output:outf, read:builtinRead}); 
//    (Sk.TurtleGraphics || (Sk.TurtleGraphics = {})).target = 'mycanvas';
   var myPromise = Sk.misceval.asyncToPromise(function() {
       return Sk.importMainWithBody("<stdin>", false, prog, true);
   });
   myPromise.then(function(mod) {
       console.log('success');
   },
       function(err) {
       console.log(err.toString());
   });
} 

document.getElementById('run-btn').onclick = () => runit();

</script>